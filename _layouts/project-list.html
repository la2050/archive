---
layout: default
# Use the default description, since this page doesnâ€™t contain general text
use_default_meta_description: true
stylesheets:
  - "/assets/css/project-list.css"
---

<h1 style="color: white; position: absolute; left: -9999px">My LA2050</h1>

{% comment %}
<div class="introduction" style="margin-top: 6em; margin-bottom: 6em;">
  <p>Here are the organizations that have submitted projects in the <span style="text-transform: uppercase;">{{ page.category }}</span> category.</p>
  <p><small>Select an organization to learn more about plans, goals, and opportunities to be involved.</small></p>
</div>
{% endcomment %}

{% if page.category %}

{% assign data_collection = site.collections | where: "label", page.category | first %}
{% assign data_list = data_collection.docs %}

{% else %}

{% comment %}
https://stackoverflow.com/questions/42475187/jekyll-assign-concat-in-a-loop
{% endcomment %}

{% assign data_collection = site.collections | where: "label", "learn" | first %}
{% assign data_list = data_collection.docs %}

{% assign data_collection = site.collections | where: "label", "create" | first %}
{% for item in data_collection.docs %}
  {% assign data_list = data_list | push: item %}
{% endfor %}

{% assign data_collection = site.collections | where: "label", "play" | first %}
{% for item in data_collection.docs %}
  {% assign data_list = data_list | push: item %}
{% endfor %}

{% assign data_collection = site.collections | where: "label", "connect" | first %}
{% for item in data_collection.docs %}
  {% assign data_list = data_list | push: item %}
{% endfor %}

{% assign data_collection = site.collections | where: "label", "live" | first %}
{% for item in data_collection.docs %}
  {% assign data_list = data_list | push: item %}
{% endfor %}

{% endif %}


{% include project-navigation.html %}


<ul class="proposals" id="project-list">

  {% comment %} Order alphabetically {% endcomment %}
  {% assign data_list = data_list | sort: "order" %}

  {% for data in data_list %}

  {% assign do_show_item = false %}

  {% assign is_finalist = false %}
  {% for finalist in site.finalists %}
    {% if finalist == data.uri %}
      {% assign is_finalist = true %}
    {% endif %}
  {% endfor %}

  {% assign is_winner = false %}
  {% for winner in site.winners %}
    {% if winner == data.uri %}
      {% assign is_winner = true %}
    {% endif %}
  {% endfor %}

  {% if page.winners == true and is_winner == true %}
  {% assign do_show_item = true %}
  {% elsif page.finalists == true and is_finalist == true %}
  {% assign do_show_item = true %}
  {% elsif page.winners != true and page.finalists != true %}
  {% assign do_show_item = true %}
  {% endif %}

  {% if do_show_item == true %}

  {% if page.is_search_results %}<script type="text/template">{% endif %}

  <li class="{{ data.category }}">
    <a href="{{ data.uri | replace: data.category, 'organizations' }}">
      <span class="image">
        {% assign image_url = data.project_image %}
        {% assign image_category = data.category %}

        {% if data.plan_id %}
        <img src="https://skild-prod.s3.amazonaws.com/myla2050/images/custom540/{{ data['project_image'] }}" alt="" width="540" height="428" />
        {% else %}
        <img src="https://activation.la2050.org/assets/images/{{ image_category }}/512-wide-with-aspect-10-8/{{ image_url }}" srcset="https://activation.la2050.org/assets/images/{{ image_category }}/384-wide-with-aspect-10-8/{{ image_url }} 384w, https://activation.la2050.org/assets/images/{{ image_category }}/512-wide-with-aspect-10-8/{{ image_url }} 512w, https://activation.la2050.org/assets/images/{{ image_category }}/768-wide-with-aspect-10-8/{{ image_url }} 768w, https://activation.la2050.org/assets/images/{{ image_category }}/1024-wide-with-aspect-10-8/{{ image_url }} 1024w, https://activation.la2050.org/assets/images/{{ image_category }}/1536-wide-with-aspect-10-8/{{ image_url }} 1536w, https://activation.la2050.org/assets/images/{{ image_category }}/2048-wide-with-aspect-10-8/{{ image_url }} 2048w" sizes="(min-width: 50em) 20em, 100vw" width="500" alt="" />
        {% endif %}
      </span>
      <!--
      <p class="organization">{{ data['organization_description'] }}</p>
      -->
      <h3>{{ data['organization_name'] }}</h3>
      <p class="description">{{ data['organization_activity'] }}</p>
    </a>
  </li>

  {% if page.is_search_results %}</script>{% endif %}

  {% endif %}

  {% endfor %}

</ul>



{% include project-navigation.html %}

<style>
.proposals ~ .goals .navigation .count {
  display: none;
}
</style>

<div style="margin-bottom: 4.5em"></div>



{% if page.is_search_results %}
<script>
(function() {
  if (!document.body.querySelector || !document.createDocumentFragment) return;

  var form = document.getElementById('search');
  var field = form.querySelector('input[name="keywords"]');
  var projectList = document.getElementById('project-list');

  // http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript#answer-901144
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    var name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  var keywords = getParameterByName('keywords');
  if (!keywords || !form || !field || !projectList) return; // TODO: Show an error message?

  field.value = keywords;
  var keywordsIndicator = document.getElementById('keywords');
  if (keywordsIndicator) keywordsIndicator.textContent = keywords;

  function containsKeyword(keyword, string) {
    if (!keyword || keyword == '' || keyword.length < 2) return;

    keyword = keyword.toLowerCase();

    var rank = 0;

    // Keyword as part of another word gets one point
    if (string.indexOf(keyword) >= 0) rank++;

    // Keyword used as a word by itself gets one point
    // TODO: Handle punctuation or HTML elements, before or after the keyword
    if (string.indexOf(' ' + keyword + ' ') >= 0) rank++;
    if (string.startsWith(keyword + ' ')) rank++;
    if (string.endsWith(' ' + keyword)) rank++;

    // Multiple instances of keyword add additional points
    // KUDOS: https://stackoverflow.com/questions/881085/count-the-number-of-occurrences-of-a-character-in-a-string-in-javascript
    var numberOfMatches = (string.match(new RegExp(keyword, "g")) || []).length;
    if (numberOfMatches > 2) rank += (numberOfMatches - 1);

    return rank;
  }

  function containsAnyKeyword(keywordList, string) {
    string = string.toLowerCase();
    var rank = 0;
    for (var index = 0; index < keywordList.length; index++) {
      rank += containsKeyword(keywordList[index], string);
    }
    return rank;
  }


  // https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array#2450976
  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }


  // var fragment = document.createDocumentFragment();
  var items = projectList.getElementsByTagName('script');
  var matches = [];
  for (var index = 0; index < items.length; index++) {
    var keywordList = keywords.replace(/\s/, ',').split(',');
    var rank = containsAnyKeyword(keywordList, items[index].innerHTML);
    if (rank > 0) {
      matches.push({
        item: items[index],
        rank: rank
      });
    }
  }

  matches = shuffle(matches);

  matches.sort(function (a, b) {
    // a is less than b by some ordering criterion
    if (a.rank < b.rank) {
      return -1;
    }
    // a is greater than b by the ordering criterion
    if (a.rank > b.rank) {
      return 1;
    }
    // a must be equal to b
    return 0;
  });

  matches = matches.reverse();

  for (var index = 0; index < matches.length; index++) {
     projectList.insertAdjacentHTML('beforeend', matches[index].item.innerHTML);
  }

  var projectCount = document.getElementById('project-count');
  var projectCountAreIs = document.getElementById('project-count-are-is');
  var projectCountProjects = document.getElementById('project-count-projects');
  if (projectCount) projectCount.innerText = projectList.getElementsByTagName('li').length;
  if (projectCountAreIs) projectCountAreIs.innerText = projectList.getElementsByTagName('li').length === 1 ? 'is' : 'are';
  if (projectCountProjects) projectCountProjects.innerText = projectList.getElementsByTagName('li').length === 1 ? 'organization' : 'organizations';

  //projectList.appendChild(fragment);

})();
</script>
{% endif %}



<script>
(function() {
  var key = 'scrollPositionOnLastProjectListPage';
  // console.log('localStorage.getItem(key): ' + localStorage.getItem(key));
  if (localStorage.getItem(key)) {
    window.scrollTo(0, localStorage.getItem(key));
    localStorage.removeItem(key);
  }
})();
</script>


